<div class="card">
    <div class="card-header">
        <h5 class="mb-0">
            <i class="bi bi-cash-stack me-2"></i> Flujo Operativo Consolidado
        </h5>
    </div>
    <div class="card-body">
        <div class="table-responsive mb-4">
            <table class="table table-bordered" id="tabla-fo-periodos">
                <thead>
                    <tr>
                        <th style="width: 40%;">Cuenta</th>
                        <th class="text-end" style="width: 20%;">Total</th>
                    </tr>
                </thead>
                <tbody>
    <tr data-key="VENTAS"><td>Ventas</td><td class="text-end">0.00</td></tr>
    <tr data-key="VENTAS_EXPORTACION"><td>Ventas Exportación</td><td class="text-end">0.00</td></tr>
    <tr data-key="CARTERA"><td>Cartera</td><td class="text-end">0.00</td></tr>
    <tr data-key="TRANSPORTES_ING"><td>Transportes (Ingreso)</td><td class="text-end">0.00</td></tr>
    <tr data-key="OTROS_INGRESOS"><td>Otros Ingresos</td><td class="text-end">0.00</td></tr>
    <tr data-key="TOTAL_INGRESOS" class="table-active"><td class="fw-bold">Total Ingresos</td><td class="text-end fw-bold">0.00</td></tr>
    <tr data-key="GASTOS_ADMINISTRATIVOS"><td>Gastos Administrativos</td><td class="text-end">0.00</td></tr>
    <tr data-key="GASTOS_COMERCIALES"><td>Gastos Comerciales</td><td class="text-end">0.00</td></tr>
    <tr data-key="GASTOS_PRODUCCION"><td>Gastos Producción</td><td class="text-end">0.00</td></tr>
    <tr data-key="ENVIOS_CTA_CORP"><td>Envíos Cuenta Corporativa</td><td class="text-end">0.00</td></tr>
    <tr data-key="IMPUESTOS"><td>Impuestos</td><td class="text-end">0.00</td></tr>
    <tr data-key="TRANSPORTES_EGR"><td>Transportes (Egreso)</td><td class="text-end">0.00</td></tr>
    <tr data-key="CUENTAS_POR_PAGAR"><td>Cuentas por Pagar</td><td class="text-end">0.00</td></tr>
    <tr data-key="INVERSIONES"><td>Inversiones</td><td class="text-end">0.00</td></tr>
    <tr data-key="OTROS_GASTOS"><td>Otros Gastos</td><td class="text-end">0.00</td></tr>
    <tr data-key="TOTAL_EGRESOS" class="table-active"><td class="fw-bold">Total Egresos</td><td class="text-end fw-bold">0.00</td></tr>
    <tr data-key="SALDO_ANTERIOR"><td>Saldo Anterior</td><td class="text-end">0.00</td></tr>
    <tr data-key="SALDO_ACTUAL" class="table-success"><td class="fw-bold">Saldo Actual</td><td class="text-end fw-bold">0.00</td></tr>
</tbody>
            </table>
        </div>
    </div>
</div>

<script>
function actualizarTablaFlujoOperativo(datos) {
    const tabla = document.getElementById('tabla-fo-periodos');
    if (!tabla || !datos) return;

    const headRow = tabla.querySelector('thead tr');
    const cuentaTh = headRow.querySelectorAll('th')[0];
    const totalTh = headRow.querySelectorAll('th')[1];
    headRow.innerHTML = '';
    if (cuentaTh) headRow.appendChild(cuentaTh);

    (datos.periodos || []).forEach((p) => {
        const th = document.createElement('th');
        th.className = 'text-end';
        th.textContent = p;
        headRow.appendChild(th);
    });

    if (totalTh) headRow.appendChild(totalTh);

    const rows = tabla.querySelectorAll('tbody tr[data-key]');
    rows.forEach((tr) => {
        const key = tr.getAttribute('data-key');
        const series = (datos.series && datos.series[key]) ? datos.series[key] : [];
        const total = series.reduce((a, b) => a + (Number(b) || 0), 0);

        const tds = tr.querySelectorAll('td');
        const cuentaTd = tds[0];
        const totalTd = tds[1];

        tr.innerHTML = '';
        if (cuentaTd) tr.appendChild(cuentaTd);

        (datos.periodos || []).forEach((_, idx) => {
            const td = document.createElement('td');
            td.className = 'text-end';
            td.textContent = formatNumber(series[idx] || 0);
            tr.appendChild(td);
        });

        if (totalTd) {
            totalTd.textContent = formatNumber(total);
            tr.appendChild(totalTd);
        }
    });
}

window.actualizarTablaFlujoOperativo = actualizarTablaFlujoOperativo;
</script>
