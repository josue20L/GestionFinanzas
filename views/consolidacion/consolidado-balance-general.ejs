<div class="card">
    <div class="card-header">
        <h5 class="mb-0">
            <i class="bi bi-bank me-2"></i> Balance General Consolidado
        </h5>
    </div>
    <div class="card-body">
        <div class="table-responsive mb-4">
            <table class="table table-bordered" id="tabla-balance-periodos">
                <thead>
                    <tr>
                        <th style="width: 40%;">Cuenta</th>
                        <th class="text-end" style="width: 20%;">Total</th>
                    </tr>
                </thead>
                <tbody>
    <tr data-key="DISPONIBLE"><td>Disponible</td><td class="text-end">0.00</td></tr>
    <tr data-key="EXIGIBLE"><td>Exigible</td><td class="text-end">0.00</td></tr>
    <tr data-key="REALIZABLE"><td>Realizable</td><td class="text-end">0.00</td></tr>
    <tr data-key="ACTIVO_CORRIENTE" class="table-active"><td class="fw-bold">Activo Corriente</td><td class="text-end fw-bold">0.00</td></tr>
    <tr data-key="ACTIVO_FIJO_TANGIBLE"><td>Activo Fijo Tangible</td><td class="text-end">0.00</td></tr>
    <tr data-key="ACTIVO_DIFERIDO"><td>Activo Diferido</td><td class="text-end">0.00</td></tr>
    <tr data-key="OTROS_ACTIVOS"><td>Otros Activos</td><td class="text-end">0.00</td></tr>
    <tr data-key="ACTIVO_NO_CORRIENTE" class="table-active"><td class="fw-bold">Activo No Corriente</td><td class="text-end fw-bold">0.00</td></tr>
    <tr data-key="TOTAL_ACTIVO" class="table-success"><td class="fw-bold">Total Activo</td><td class="text-end fw-bold">0.00</td></tr>
    <tr data-key="PASIVO_CORRIENTE" class="table-active"><td class="fw-bold">Pasivo Corriente</td><td class="text-end fw-bold">0.00</td></tr>
    <tr data-key="PREVISION_BENEFICIOS_SOCIALES"><td>Previsi√≥n Beneficios Sociales</td><td class="text-end">0.00</td></tr>
    <tr data-key="OBLIGACIONES_BANCARIAS"><td>Obligaciones Bancarias</td><td class="text-end">0.00</td></tr>
    <tr data-key="INTERESES_POR_PAGAR"><td>Intereses por Pagar</td><td class="text-end">0.00</td></tr>
    <tr data-key="PROCESOS_LEGALES"><td>Procesos Legales</td><td class="text-end">0.00</td></tr>
    <tr data-key="PASIVO_NO_CORRIENTE" class="table-active"><td class="fw-bold">Pasivo No Corriente</td><td class="text-end fw-bold">0.00</td></tr>
    <tr data-key="PATRIMONIO" class="table-active"><td class="fw-bold">Patrimonio</td><td class="text-end fw-bold">0.00</td></tr>
    <tr data-key="TOTAL_PASIVO_PATRIMONIO" class="table-success"><td class="fw-bold">Total Pasivo y Patrimonio</td><td class="text-end fw-bold">0.00</td></tr>
</tbody>
            </table>
        </div>
    </div>
</div>

<script>
function actualizarTablaBalance(datos) {
    const tabla = document.getElementById('tabla-balance-periodos');
    if (!tabla || !datos) return;

    const headRow = tabla.querySelector('thead tr');
    const cuentaTh = headRow.querySelectorAll('th')[0];
    const totalTh = headRow.querySelectorAll('th')[1];
    headRow.innerHTML = '';
    if (cuentaTh) headRow.appendChild(cuentaTh);

    (datos.periodos || []).forEach((p) => {
        const th = document.createElement('th');
        th.className = 'text-end';
        th.textContent = p;
        headRow.appendChild(th);
    });

    if (totalTh) headRow.appendChild(totalTh);

    const rows = tabla.querySelectorAll('tbody tr[data-key]');
    rows.forEach((tr) => {
        const key = tr.getAttribute('data-key');
        const series = (datos.series && datos.series[key]) ? datos.series[key] : [];
        const total = series.reduce((a, b) => a + (Number(b) || 0), 0);

        const tds = tr.querySelectorAll('td');
        const cuentaTd = tds[0];
        const totalTd = tds[1];

        tr.innerHTML = '';
        if (cuentaTd) tr.appendChild(cuentaTd);

        (datos.periodos || []).forEach((_, idx) => {
            const td = document.createElement('td');
            td.className = 'text-end';
            td.textContent = formatNumber(series[idx] || 0);
            tr.appendChild(td);
        });

        if (totalTd) {
            totalTd.textContent = formatNumber(total);
            tr.appendChild(totalTd);
        }
    });
}

window.actualizarTablaBalance = actualizarTablaBalance;
</script>
